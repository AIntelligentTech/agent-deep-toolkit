# Agent Deep Toolkit v3.0.0 – Deep Tools Model, Intelligent Uninstaller, and Cursor Integration Plan

This plan introduces an intelligent, configurable uninstaller and first-class Cursor integration (both via Claude-first `CLAUDE.md` templates and dedicated Cursor assets) while preserving the toolkit’s portability, safety, and open-source friendliness.

## 1. Goals and Non-goals

- **Goals**
  - Provide an **intelligent uninstaller** that can:
    - Detect existing Agent Deep Toolkit installations across Windsurf, Claude Code, and Cursor-specific targets (including Cursor users who do not use the separate Claude Code extension).
    - Handle **legacy installs** (pre-0.3.0) that may lack version metadata.
    - Detect and clean up **renamed or relocated commands/files** based on robust content markers, not just filenames.
    - Offer configurable behaviors such as `--uninstall`, `--clean-up`, and `--dry-run` suitable for both manual and automated use.
  - Introduce a top-level **`cursor/` directory** that focuses on Cursor integration:
    - `CLAUDE.md` templates and examples that expose deep-* commands cleanly inside Cursor.
    - Optional Cursor-specific assets (e.g., dedicated ADT `CLAUDE.*.md` files or small helper configs) that can be installed/uninstalled via `--agent cursor` without requiring `.claude/skills`.
    - Focused documentation describing how to wire these assets into Cursor, and how they relate (or do not relate) to Claude Code.
  - Keep the **CLI ergonomics and safety** aligned with open-source best practices:
    - Clear, predictable flags.
    - Idempotent operations where possible.
    - Well-documented behavior for command chaining and multi-command usage.
  - Maintain and enhance **portability** (macOS/Linux, `bash`) and simple local installation story.

- **Non-goals (for v0.3.0)**
  - Adding support for OS-level package managers or Windows-native installers.
  - Building a GUI around the installer/uninstaller.
  - Providing a full "doctor"/diagnostics subsystem beyond basic detection and reporting.

## 2. Current State (v0.2.0)

- **Installer**
  - Single `install.sh` script with `bash` + `set -euo pipefail`.
  - Supports `--agent` (`windsurf`, `windsurf-next`, `claude`, `all`) and `--level` (`project`, `user`) plus `--project-dir`, `--force`, and `--dry-run`.
  - Writes `.agent-deep-toolkit-version` into target directories (`.windsurf/workflows`, Windsurf Next global, `.claude/skills`).
  - Uses conservative copying and does not perform any uninstallation.

- **Documentation**
  - `README.md` documents requirements, what the installer does, `--dry-run`, versioning/upgrades, and **manual uninstall** steps.
  - No automated uninstaller or Cursor-specific documentation exists.

- **Versioning**
  - `VERSION` at `0.2.0`.
  - `CHANGELOG.md` documents 0.1.0 and 0.2.0.

## 3. Deep Tools Model, Templates, and Outputs

- **Single source of truth: `deep-tools.json`**
  - Add a root-level `deep-tools.json` file that defines all deep tools in an agent-agnostic way:
    - `id`, `category`, `summary`, `description`, `tags`.
    - `canonical_reference` pointing to the primary procedure markdown.
    - Optional safety metadata and per-agent presentation hints (names, groupings, notes).
  - This file becomes the **only canonical registry** for deep tools; all agent-specific surfaces are generated from it.

- **Single templating / generation engine**
  - Introduce a single generator script (e.g. `bin/generate-deep-tools`) that:
    - Reads `deep-tools.json`.
    - Applies per-agent templates (Mustache/Handlebars-style, or a minimal equivalent) for:
      - Windsurf / Windsurf Next workflows.
      - Claude Code SKILL definitions.
      - Cursor `CLAUDE.*.md` templates.
    - Writes final artifacts into `output/<agent>/...` directories.
  - Run this generator **at dev/release time**, not at user install time, to keep `install.sh` lightweight and dependency-free.

- **Per-agent template sets (clean separation)**
  - `templates/windsurf/` – templates for Windsurf and Windsurf Next workflows (shared content; differences are just target paths/labels at install time).
  - `templates/claude/` – templates for Claude Code skills (`SKILL.md` sections and any reference wiring).
  - `templates/cursor/` – templates for Cursor-focused `CLAUDE.*.md` files and any Cursor-only assets.

- **Generated payloads under `output/<agent>/`**
  - `output/windsurf/workflows/deep-*.md`
  - `output/claude/skills/<skill>/SKILL.md` and any associated scaffold referenced by the installer.
  - `output/cursor/CLAUDE.agent-deep-*.md` (or a namespaced layout) for Cursor users.
  - Optionally, plain-text **per-agent manifests** alongside outputs, listing installed files for use by the uninstaller.

- **Install/uninstall integration**
  - Update `install.sh` so that its source directories are the `output/<agent>/...` trees rather than hand-maintained files:
    - Windsurf/Windsurf Next: copy from `output/windsurf/workflows`.
    - Claude Code: copy from `output/claude/skills`.
    - Cursor-only: copy from `output/cursor/`.
  - The intelligent uninstaller uses:
    - Generated manifests (from the same model) where available.
    - Existing `.agent-deep-toolkit-version` files and content markers for legacy installs.

## 4. Intelligent Uninstaller Requirements

- **Detection**
  - Detect installations created by `install.sh` 0.1.0–0.3.0:
    - Using `.agent-deep-toolkit-version` when present.
    - Scanning for canonical workflow/skill content when the version file is missing.
  - For **renamed commands/files**:
    - Identify candidate files by content markers (e.g. distinct YAML frontmatter fields, recognizable headings, or embedded comments like "Source: Agent Deep Toolkit").
    - Treat filename mismatches as a signal but not a hard blocker for detection.

- **Removal behavior**
  - **Standard uninstall (`--uninstall`)**
    - Remove files and directories that were installed by the toolkit, scoped by `--agent` and `--level`.
    - Do not aggressively delete unknown files that merely coexist in the same directories.
  - **Clean-up mode (`--clean-up`)**
    - Optionally remove **orphaned** or partially modified Toolkit artifacts, including files that:
      - Match strong content signatures but no longer match expected filenames.
      - Coexist with missing version files.
    - Provide clear logging and `--dry-run` preview before deleting.
  - Support both **interactive** (prompt before destructive actions) and **non-interactive** (`--yes` / `--non-interactive`) modes for automation.

- **CLI and UX**
  - Extend the existing `install.sh` interface in a backwards-compatible way.
  - Ensure commands:
    - Return meaningful exit codes for use with `&&`/`||` chains and within Cursor tools.
    - Print concise, structured logs (`[info]`, `[warn]`, `[ok]`, `[dry-run]`, `[remove]`, `[skip]`).
  - Keep semantics consistent across agents (Windsurf, Claude Code, and Cursor) to avoid user confusion.

- **Portability and safety**
  - Remain `bash`-only, with no extra runtime dependencies.
  - Avoid destructive globbing or `rm -rf` that could remove non-toolkit user content.
  - Refuse operations that target dangerous paths (e.g., `PROJECT_DIR=/`), mirroring install safety checks.

## 5. CLI Design for Install + Uninstall

### 4.1 High-level approach

- **Single entrypoint**: keep `install.sh` as the primary CLI, but conceptually rename it in docs to "installer/uninstaller".
- Add an **action mode** on top of existing options:
  - Default mode (no explicit action flags) remains **install**, preserving current behavior.
  - Introduce explicit action flags:
    - `--uninstall` – perform uninstallation instead of installation.
    - `--clean-up` – augment uninstall with deeper cleanup of legacy/renamed artifacts.
    - Optionally, `--detect-only` or `--list-installs` for a non-destructive detection mode.

### 4.2 Proposed CLI surface

- **Install (existing behavior)**
  - `./install.sh --agent windsurf --level project [--project-dir <dir>] [--force] [--dry-run]`
  - `./install.sh --agent all --level user [--force] [--dry-run]`
  - `./install.sh --agent cursor --level project [--project-dir <dir>] [--force] [--dry-run]`
  - `./install.sh --agent cursor --level user [--force] [--dry-run]` (if a user-level Cursor config location is later supported).

- **Uninstall**
  - `./install.sh --uninstall --agent windsurf --level project [--project-dir <dir>] [--dry-run] [--yes]`
  - `./install.sh --uninstall --agent claude --level user [--dry-run] [--yes]`
  - `./install.sh --uninstall --agent all --level user [--dry-run] [--yes]`
  - `./install.sh --uninstall --agent cursor --level project [--project-dir <dir>] [--dry-run] [--yes]`
  - `./install.sh --uninstall --agent cursor --level user [--dry-run] [--yes]` (if a user-level Cursor config location is later supported).

- **Uninstall with clean-up**
  - `./install.sh --uninstall --clean-up --agent all --level user [--dry-run] [--yes]`
    - Detects and removes both clean installs and strongly identified legacy/renamed artifacts.

- **Detection/report-only mode (optional but recommended)**
  - `./install.sh --detect-only --agent all --level user [--project-dir <dir>]`
    - Print a structured summary of detected installations, their versions, and detection confidence levels, but do not delete anything.

### 4.3 Internal structure

- Extend `install.sh` with:
  - Action flags: `UNINSTALL=false`, `CLEAN_UP=false`, `DETECT_ONLY=false`, `NON_INTERACTIVE=false`.
  - A **routing layer** after argument parsing:
    - If `DETECT_ONLY=true` → run detection and exit.
    - Else if `UNINSTALL=true` → run uninstall path (optionally adding clean-up behavior).
    - Else → run install path (current behavior).
  - Shared helper functions:
    - `detect_windsurf_installs`, `detect_claude_installs`, `detect_cursor_installs`.
    - `prompt_confirm` (skipped when `NON_INTERACTIVE` or `DRY_RUN` is true).
    - `remove_path_safe` for guarded deletions.

## 6. Detection and Metadata Strategy

### 5.1 Existing metadata

- **Version markers**
  - `.agent-deep-toolkit-version` file already written into target directories.
  - v0.3.0 uninstaller will:
    - Treat presence of this file as a strong indicator of an install.
    - Read it for version reporting and uninstallation logs.

### 5.2 New metadata / signatures for v0.3.0+

- **Per-agent manifest** (optional, but recommended for maintainability):
  - On install, create a small manifest file adjacent to the version file, e.g.:
    - `.agent-deep-toolkit-manifest.json` or `.agent-deep-toolkit-manifest` (plain text/YAML) containing:
      - List of files that were installed by this toolkit and version.
      - A stable toolkit identifier (e.g., `agent-deep-toolkit`), version, timestamp.
  - Uninstaller can then remove exactly those files, avoiding accidental deletion of user-created content.

- **Content signatures**
  - Embed lightweight, human-friendly markers in installed artifacts (if not already present):
    - For Windsurf workflows and Claude references: a short comment or frontmatter field identifying the source, such as `source: agent-deep-toolkit` or `origin: Agent Deep Toolkit`.
    - For Cursor tool definitions: a dedicated field or comment like `"source": "agent-deep-toolkit"`.
  - Use these markers to:
    - Detect legacy installs that lack manifests but still carry recognizable content.
    - Identify renamed files (same content, different filename).

### 5.3 Detection algorithm (per agent)

- **Phase 1 – Manifest-based**
  - If manifest present in a known target directory:
    - Load list of installed paths.
    - Filter to paths that still exist.
    - Classify as **definite** toolkit artifacts.

- **Phase 2 – Version-file based**
  - If only `.agent-deep-toolkit-version` exists:
    - Check for expected canonical filenames under the directory.
    - Check for content markers in those files where applicable.
    - Classify as **strong** detection.

- **Phase 3 – Heuristic/content-based**
  - Scan for files matching:
    - Known filename patterns (e.g., `deep-*.md`, `deep-*` skill dirs, Cursor-specific ADT files such as `CLAUDE.agent-deep-*.md`).
    - Content markers (frontmatter fields, comments, or metadata keys referencing Agent Deep Toolkit).
  - Classify as **probable** detection.

- **Reporting**
  - For each candidate installation, report:
    - Agent and level.
    - Root path.
    - Version (if known).
    - Detection confidence: `definite`, `strong`, `probable`.
  - Use confidence level and `--clean-up` flag to decide whether to delete.

## 7. Cursor + CLAUDE.md Integration Architecture (`cursor/` directory)

### 6.1 High-level objectives

- Provide a clear, isolated place for **Cursor-related documentation and templates**, aligned with how Windsurf and Claude are separated today.
- Make it easy for users to:
  - Use existing Claude Code skills and commands inside Cursor via `CLAUDE.md`.
  - Reuse deep-* workflows and skills without any Cursor-specific install agent.
  - Understand command chaining and multi-command behavior within Cursor.

### 6.2 Proposed `cursor/` layout

- `cursor/`
  - `README.md` – Cursor-specific documentation (how to use `.claude/skills` and/or Cursor-only assets with `CLAUDE.md`, how installation/uninstallation works via `--agent cursor` and/or `--agent claude`, example commands and screenshots where applicable).
  - `templates/` – `CLAUDE.md` (or snippet) templates that define deep-* commands for Cursor in a Claude-first way (e.g., `CLAUDE.agent-deep-toolkit.md` files that can be dropped into a project).
  - `examples/` (optional) – example command patterns and prompt snippets for users.

> Note: Cursor integration relies on its first-class Claude support and `CLAUDE.md` conventions, but this plan also introduces a dedicated `--agent cursor` path so Cursor-only users (who do not use the Claude Code extension) can adopt Agent Deep Toolkit without touching `.claude/skills`.

### 6.3 Cursor usage flow (dedicated agent + CLAUDE.md)

- Introduce a new `--agent cursor` for Cursor-specific assets:
  - `./install.sh --agent cursor --level project` may, for example, copy one or more `CLAUDE.agent-deep-*.md` templates into `<project>/` or a clearly namespaced subdirectory.
  - These templates are then referenced or merged into the project’s primary `CLAUDE.md` according to Cursor best practices (documented in `cursor/README.md`).
- Continue to support Claude Code via the existing `--agent claude` pathways for users who also use the Claude Code extension.
- In `cursor/README.md`, document:
  - How to include or adapt the provided `CLAUDE.md` templates/snippets.
  - How uninstall works through the Cursor installer/uninstaller (`--agent cursor`) and, where relevant, Claude installer/uninstaller (`--agent claude`).

### 6.4 Metadata for `CLAUDE.md` commands

- Ensure `CLAUDE.md` templates and examples include:
  - Stable and descriptive command names (e.g., `Deep: Explore`, `Deep: Debug`, `Deep: Audit`).
  - A short note or comment indicating they are powered by Agent Deep Toolkit workflows/skills.
  - Clear description and usage hints, including expectations around command chaining and multi-command prompts.

## 8. Command Chaining and Multi-command Semantics

### 7.1 Shell-side composability

- Design `install.sh` actions to be **composable in shell chains**:
  - Always return `0` on success (including "nothing to do" cases for uninstall/detect-only), and non-zero on unexpected failures.
  - Avoid partial success statuses that are ambiguous for `&&`/`||` logic.
  - Maintain a clear distinction between:
    - Hard failures (e.g., invalid arguments, missing required paths).
    - Soft no-ops (e.g., nothing found to uninstall).

- Ensure logs are concise and machine/AI-readable so that Cursor tools and prompts can surface them effectively.

### 7.2 Multiple commands per prompt (Cursor and others)

- Assume users may:
  - Chain toolkit commands within a single shell tool in Cursor (e.g., `./install.sh ... && ./install.sh --uninstall ...`).
  - Combine toolkit commands with project-specific cleanups (e.g., `./install.sh --uninstall ... && git restore .`).

- Design guidelines for commands to be documented in `README.md` and `cursor/README.md`:
  - Prefer **single-responsibility invocations** in examples (one primary action per command) but show safe chaining patterns.
  - Emphasize using `--dry-run` first in multi-command workflows.
  - Highlight that `--uninstall` + `--clean-up` is more aggressive and should usually be the final step in a chain.

### 7.3 Prompt and position behavior

- When documenting Cursor tools:
  - Clarify that these tools should be treated as **side-effectful operations** and should usually be called explicitly (e.g., via a tool button or explicit invocation) rather than implicitly in arbitrary prompts.
  - Recommend that commands involving `--uninstall`/`--clean-up` be surfaced as **separate tools** or explicit actions, not bundled behind generic "fix" or "setup" tools, to reduce accidental misuse.

## 9. Portability, Safety, and Testing

### 8.1 Portability

- Continue to target:
  - macOS (Apple Silicon and Intel) with Home directory semantics.
  - Linux distributions with a standard `$HOME` and `/usr/bin/env bash`.
- Avoid features that are:
  - Bash-version-specific beyond what is already used (e.g., no associative arrays unless carefully gated).
  - OS-specific path assumptions beyond `$HOME` and user-level configuration directories.

### 8.2 Safety practices

- Use guarded deletion helpers:
  - `remove_path_safe` that validates paths against a whitelist of expected prefixes (e.g., `~/.windsurf/workflows`, `~/.claude/skills`, project `.windsurf`/`.claude` subdirectories, and any Cursor-specific prefixes chosen for ADT assets such as `<project>/CLAUDE.agent-deep-*.md` or a dedicated `<project>/.agent-deep-cursor/` directory).
  - Explicitly refuse to delete if the resolved path is `/`, empty, or outside allowed root directories.

- Respect `DRY_RUN` everywhere:
  - All new uninstall/cleanup code must branch on `DRY_RUN` in the same way as the installer.

### 8.3 Testing matrix (manual + scripted checks)

- **Scenarios**
  - Fresh install and uninstall for each agent (`windsurf`, `windsurf-next`, `claude`, `cursor`).
  - Upgrade path from v0.2.0 → v0.3.0, including:
    - Pre-existing installs with `.agent-deep-toolkit-version`.
    - Pre-existing installs where users have renamed deep-* files.
  - `--dry-run` for install and uninstall/clean-up.
  - Detection-only mode where implemented.

- **OS coverage**
  - At least one macOS and one Linux environment for smoke testing.

## 10. Documentation, Git, and Release Steps

### 9.1 Documentation updates

- **Root `README.md`**
  - Add sections for:
    - Automated uninstall overview and examples (`--uninstall`, `--clean-up`, `--detect-only`).
    - Safety model for deletion (what is and is not removed).
  - Update the existing manual uninstall section to:
    - Point to the new uninstaller as the primary path.
    - Retain manual steps as a fallback.

- **New `UNINSTALL.md` (optional)**
  - Provide a focused, task-oriented guide to uninstalling the toolkit across all agents.

- **`cursor/README.md`**
  - Explain:
    - What Cursor assets are provided (documentation, `CLAUDE.md` templates/snippets, examples).
    - How to wire `CLAUDE.md` and `.claude/skills` into Cursor.
    - How to uninstall or clean up via the Claude uninstaller paths.
    - Recommendations for using toolkit commands within multi-command Cursor tools.

### 10.2 Changelog and versioning

- Bump `VERSION` from `0.2.0` → `3.0.0`.
- Add a `3.0.0` section to `CHANGELOG.md` summarizing:
  - Intelligent uninstaller with `--uninstall`, `--clean-up`, and detection improvements.
  - New Cursor + `CLAUDE.md` integration and optional `cursor/` docs/templates directory.
  - Any new manifest/metadata behavior.

### 10.3 Git workflow (open-source best practices)

- Implement in a feature branch, e.g. `feature/v3.0.0-deep-tools`.
- Keep changes logically grouped:
  - One or more commits for CLI changes and uninstall logic.
  - One for Cursor directory + docs/templates.
  - One for documentation and changelog + version bump.
- Use PR template to:
  - Document manual test coverage across install/uninstall scenarios.
  - Link to relevant issues or roadmap items.

### 9.4 Release

- After merging:
  - Tag the release as `v0.3.0`.
  - Optionally publish a GitHub Release with highlights and examples.
  - Ensure installation/uninstallation examples in the README reference the tagged version where appropriate.
